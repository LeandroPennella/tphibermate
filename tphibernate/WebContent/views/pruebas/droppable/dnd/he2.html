<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>jQuery UI Draggable - Handles</title>
    <script type="text/javascript" src="../../../ui/js/jquery-1.12.4.js"></script>
	<script type="text/javascript" src="../../../ui/js/jquery-ui-1.11.4.js"></script>
 
    
    
<script>

//dia//horario=//evento//duracion

var semana=[];
var eventos=[];

function mostrarSemana(){
	//debugger; 
	//alert('semana');
}

function cambiarEvento( evento, evento_nuevoRecipiente){
	alert('evento '+evento_id +' movido a '+ evento_nuevaHoraInicio);  
	//encontrar elemento
	
}

$( function() {
	
	
	$('.dia').each(
	
		function(){
			var $dia=$(this);
			var $dia_id=$(this).attr('id');
			//alert($dia_id);
			
			$droppables=$dia.children('.celda').children('.droppable');
			var $droppables_ids='';
			$droppables.each(function(){
				$droppables_ids+='#'+($(this).attr('id')+',');
		   	});
		    $droppables_ids=$droppables_ids.slice(0,-1);
		    //alert($droppables_ids);
			var dia=[];	    
		    dia.id=$dia_id;
			$dia.find('.draggable').each(
					
				function(){
					var $evento=$(this);
					var $evento_id=$(this).attr('id');
					//alert('e: ' +$evento_id + ' c:' + $dia_id + 's:'+ $droppables_ids);
					
					$evento.draggable({
						axis:"y",
						containment:$dia,
				   		snap:$droppables_ids,
				   		snapMode:'inner'
				   		
					  });
					
					
					var evento={};					
					evento.id=$evento_id
					evento.horario=$evento.parent().attr('id')
					dia.push(evento);
					//tablaPosiciones.push[{"dia":$dia_id}]
					//todo: crear tabla posiciones
				}
			)			
			semana.push(dia);
		}
	);
	
	

	$( ".droppable" ).droppable({
  		drop: function( event, ui ) {
			var evento_id = $(ui.draggable).attr('id');
			var evento = $(ui.draggable);
 	   		var evento_nuevaHoraInicio = $(this).attr("id").toString();	 	         	   		
 	   		//cambiarEvento(evento_id,evento_nuevaHoraInicio);
 	   		evento.css('top',0);
 	   		evento.css('left',0);
 	   		$(this).append($(ui.draggable));
  		}
	});
	
	mostrarSemana();

});
</script>
<style>
	.dia {float:left; width:13.33vw;}
	
	.celda {
		height: 40px;
		border:1px solid gray;
		z-index:0; 
		display:flex;
		width: 100%; 
	}
	
	.droppable {
		height: 1px;
		border:0;
		z-index:0;
		display:flex;
		width: 100%; 
	}
	  
	.evento{
		height:90px;
		border:1px solid red;
		box-sizing: border-box;
		word-break: break-all; 
		word-wrap: break-word;
		flex-basis: 100%;
	}
	
	.draggable{
		height:1px; 
		flex-basis: 100%;
	}
</style>


</head>
<body>
<div class="dia" id="d1">
  <div class="celda"><div class="droppable" id="d1h1"></div></div>
  <div class="celda"><div class="droppable" id="d1h2">
  
    <div class="draggable "  id="e1" >
      <div class="evento"  >
      	<a href="#">sarasa</a>
      </div>
    </div>
    
    <div class="draggable " id="e1b" >
      <div class="evento" >
      	<a href="#">sarasa</a>
      </div>
    </div>
    
  </div></div>
  <div class="celda"><div class="droppable" id="d1h3"></div></div>
  <div class="celda"><div class="droppable"  id="d1h4"></div></div>
  <div class="celda"><div class="droppable" id="d1h5"></div></div>
</div>

<div class="dia" id="d2">

  <div class="celda"><div class="droppable" id="d2h1"></div></div>
  <div class="celda"><div class="droppable" id="d2h2">
    <div class="draggable  " id="e2">      
      <div class="evento" >
	      <a href="#">
	      	sarasa
	      </a>
      </div>
    </div>
  </div></div>
  <div class="celda"><div class="droppable" id="d2h3"></div></div>
  <div class="celda"><div class="droppable" id="d2h4"></div></div>
  <div class="celda"><div class="droppable"  id="d2h5"></div></div>
</div>
 
</body>
</html>